"use strict";(self.webpackChunkszallas_foglalo=self.webpackChunkszallas_foglalo||[]).push([[722],{722:(O,M,i)=>{i.r(M),i.d(M,{RoomFormComponent:()=>et});var m=i(177),a=i(9417),F=i(8498),C=i(5596),k=i(8599),P=i(3746),v=i(4308),y=i(2798),g=i(1551),s=i(6471),l=i(9183),_=i(8822),u=i(5558),f=i(7673),t=i(9498),D=i(8081),j=i(3888),x=i(3733),T=i(1958),B=i(246);const z=()=>({standalone:!0}),A=o=>["/hotels",o],L=()=>["/rooms"];function G(o,d){1&o&&(t.qex(0),t.j41(1,"div",4),t.nrm(2,"mat-spinner"),t.k0s(),t.bVm())}function K(o,d){if(1&o&&(t.j41(0,"mat-option",34),t.EFF(1),t.k0s()),2&o){const e=d.$implicit;t.Y8G("value",e.id),t.R7$(),t.SpI(" ",e.name," ")}}function S(o,d){1&o&&(t.j41(0,"mat-error"),t.EFF(1," Hotel kiv\xe1laszt\xe1sa k\xf6telez\u0151 "),t.k0s())}function U(o,d){1&o&&(t.j41(0,"mat-error"),t.EFF(1," Szobasz\xe1m k\xf6telez\u0151 "),t.k0s())}function $(o,d){1&o&&(t.j41(0,"mat-error"),t.EFF(1," Szoba t\xedpusa k\xf6telez\u0151 "),t.k0s())}function N(o,d){1&o&&(t.j41(0,"mat-error"),t.EFF(1," \xc1r k\xf6telez\u0151 "),t.k0s())}function H(o,d){1&o&&(t.j41(0,"mat-error"),t.EFF(1," Az \xe1r nem lehet negat\xedv "),t.k0s())}function W(o,d){1&o&&(t.j41(0,"mat-error"),t.EFF(1," F\xe9r\u0151helyek sz\xe1ma k\xf6telez\u0151 "),t.k0s())}function Y(o,d){1&o&&(t.j41(0,"mat-error"),t.EFF(1," Legal\xe1bb 1 f\xe9r\u0151hely sz\xfcks\xe9ges "),t.k0s())}function V(o,d){1&o&&(t.j41(0,"mat-error"),t.EFF(1," Le\xedr\xe1s k\xf6telez\u0151 "),t.k0s())}function X(o,d){if(1&o){const e=t.RV6();t.j41(0,"mat-chip",37),t.bIt("removed",function(){const n=t.eBV(e).index,p=t.XpG(3);return t.Njj(p.removeAmenity(n))}),t.EFF(1),t.j41(2,"button",38)(3,"mat-icon"),t.EFF(4,"cancel"),t.k0s()()()}if(2&o){const e=d.$implicit;t.R7$(),t.SpI(" ",e.value," ")}}function J(o,d){if(1&o&&(t.j41(0,"div",35)(1,"mat-chip-set"),t.DNE(2,X,5,1,"mat-chip",36),t.k0s()()),2&o){const e=t.XpG(2);t.R7$(2),t.Y8G("ngForOf",e.amenities.controls)}}function w(o,d){if(1&o&&t.nrm(0,"img",44),2&o){const e=t.XpG().$implicit;t.Y8G("src",e.value,t.B4B)}}function Z(o,d){if(1&o){const e=t.RV6();t.j41(0,"div",39)(1,"mat-form-field",40)(2,"mat-label"),t.EFF(3),t.k0s(),t.nrm(4,"input",41),t.k0s(),t.j41(5,"button",42),t.bIt("click",function(){const n=t.eBV(e).index,p=t.XpG(2);return t.Njj(p.removeImage(n))}),t.j41(6,"mat-icon"),t.EFF(7,"delete"),t.k0s()(),t.DNE(8,w,1,1,"img",43),t.k0s()}if(2&o){const e=d.$implicit,r=d.index,n=t.XpG(2);t.R7$(3),t.SpI("K\xe9p URL ",r+1,""),t.R7$(),t.Y8G("formControlName",r),t.R7$(),t.Y8G("disabled",1===n.images.length),t.R7$(3),t.Y8G("ngIf",e.value)}}function Q(o,d){1&o&&(t.qex(0),t.nrm(1,"mat-spinner",45),t.bVm())}function q(o,d){if(1&o&&t.EFF(0),2&o){const e=t.XpG(2);t.SpI(" ",e.isEditMode?"Ment\xe9s":"L\xe9trehoz\xe1s"," ")}}function tt(o,d){if(1&o){const e=t.RV6();t.j41(0,"form",5),t.bIt("ngSubmit",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.onSubmit())}),t.j41(1,"div",6)(2,"mat-form-field",7)(3,"mat-label"),t.EFF(4,"Hotel"),t.k0s(),t.j41(5,"mat-select",8),t.DNE(6,K,2,2,"mat-option",9),t.nI1(7,"async"),t.k0s(),t.DNE(8,S,2,0,"mat-error",10),t.k0s()(),t.j41(9,"div",6)(10,"mat-form-field",7)(11,"mat-label"),t.EFF(12,"Szobasz\xe1m"),t.k0s(),t.nrm(13,"input",11),t.DNE(14,U,2,0,"mat-error",10),t.k0s()(),t.j41(15,"div",6)(16,"mat-form-field",7)(17,"mat-label"),t.EFF(18,"Szoba t\xedpusa"),t.k0s(),t.j41(19,"mat-select",12)(20,"mat-option",13),t.EFF(21,"Egy\xe1gyas"),t.k0s(),t.j41(22,"mat-option",14),t.EFF(23,"K\xe9t\xe1gyas"),t.k0s(),t.j41(24,"mat-option",15),t.EFF(25,"Lakoszt\xe1ly"),t.k0s(),t.j41(26,"mat-option",16),t.EFF(27,"Deluxe"),t.k0s()(),t.DNE(28,$,2,0,"mat-error",10),t.k0s()(),t.j41(29,"div",17)(30,"mat-form-field",18)(31,"mat-label"),t.EFF(32,"\xc1r / \xe9jszaka (Ft)"),t.k0s(),t.nrm(33,"input",19),t.DNE(34,N,2,0,"mat-error",10)(35,H,2,0,"mat-error",10),t.k0s(),t.j41(36,"mat-form-field",18)(37,"mat-label"),t.EFF(38,"F\xe9r\u0151helyek sz\xe1ma"),t.k0s(),t.nrm(39,"input",20),t.DNE(40,W,2,0,"mat-error",10)(41,Y,2,0,"mat-error",10),t.k0s()(),t.j41(42,"div",6)(43,"mat-form-field",7)(44,"mat-label"),t.EFF(45,"Le\xedr\xe1s"),t.k0s(),t.nrm(46,"textarea",21),t.DNE(47,V,2,0,"mat-error",10),t.k0s()(),t.j41(48,"div",6)(49,"h3"),t.EFF(50,"Szolg\xe1ltat\xe1sok"),t.k0s(),t.j41(51,"div",22)(52,"mat-form-field",23)(53,"mat-label"),t.EFF(54,"\xdaj szolg\xe1ltat\xe1s"),t.k0s(),t.j41(55,"input",24),t.mxI("ngModelChange",function(n){t.eBV(e);const p=t.XpG();return t.DH7(p.amenityInput,n)||(p.amenityInput=n),t.Njj(n)}),t.k0s()(),t.j41(56,"button",25),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.addAmenity())}),t.j41(57,"mat-icon"),t.EFF(58,"add"),t.k0s()()(),t.DNE(59,J,3,1,"div",26),t.k0s(),t.j41(60,"div",6)(61,"h3"),t.EFF(62,"K\xe9pek"),t.k0s(),t.j41(63,"div",27),t.DNE(64,Z,9,4,"div",28),t.j41(65,"input",29),t.bIt("change",function(n){t.eBV(e);const p=t.XpG();return t.Njj(p.onFileSelected(n))}),t.k0s(),t.j41(66,"button",30),t.bIt("click",function(){t.eBV(e);const n=t.XpG();return t.Njj(n.addImage())}),t.j41(67,"mat-icon"),t.EFF(68,"add_photo_alternate"),t.k0s(),t.EFF(69," \xdaj k\xe9p hozz\xe1ad\xe1sa "),t.k0s()()(),t.j41(70,"div",31)(71,"button",32),t.EFF(72,"M\xe9gse"),t.k0s(),t.j41(73,"button",33),t.DNE(74,Q,2,0,"ng-container",3)(75,q,1,1,"ng-template",null,1,t.C5r),t.k0s()()()}if(2&o){let e,r,n,p,b,h,R,E;const I=t.sdS(76),c=t.XpG();t.Y8G("formGroup",c.roomForm),t.R7$(6),t.Y8G("ngForOf",t.bMT(7,18,c.hotels$)),t.R7$(2),t.Y8G("ngIf",(null==(e=c.roomForm.get("hotelId"))?null:e.hasError("required"))&&(null==(e=c.roomForm.get("hotelId"))?null:e.touched)),t.R7$(6),t.Y8G("ngIf",(null==(r=c.roomForm.get("number"))?null:r.hasError("required"))&&(null==(r=c.roomForm.get("number"))?null:r.touched)),t.R7$(14),t.Y8G("ngIf",(null==(n=c.roomForm.get("type"))?null:n.hasError("required"))&&(null==(n=c.roomForm.get("type"))?null:n.touched)),t.R7$(6),t.Y8G("ngIf",(null==(p=c.roomForm.get("price"))?null:p.hasError("required"))&&(null==(p=c.roomForm.get("price"))?null:p.touched)),t.R7$(),t.Y8G("ngIf",(null==(b=c.roomForm.get("price"))?null:b.hasError("min"))&&(null==(b=c.roomForm.get("price"))?null:b.touched)),t.R7$(5),t.Y8G("ngIf",(null==(h=c.roomForm.get("capacity"))?null:h.hasError("required"))&&(null==(h=c.roomForm.get("capacity"))?null:h.touched)),t.R7$(),t.Y8G("ngIf",(null==(R=c.roomForm.get("capacity"))?null:R.hasError("min"))&&(null==(R=c.roomForm.get("capacity"))?null:R.touched)),t.R7$(6),t.Y8G("ngIf",(null==(E=c.roomForm.get("description"))?null:E.hasError("required"))&&(null==(E=c.roomForm.get("description"))?null:E.touched)),t.R7$(8),t.R50("ngModel",c.amenityInput),t.Y8G("ngModelOptions",t.lJ4(20,z)),t.R7$(4),t.Y8G("ngIf",c.amenities.controls.length>0),t.R7$(5),t.Y8G("ngForOf",c.images.controls),t.R7$(7),t.Y8G("routerLink",c.preselectedHotelId?t.eq3(21,A,c.preselectedHotelId):t.lJ4(23,L)),t.R7$(2),t.Y8G("disabled",c.roomForm.invalid||c.isSubmitting),t.R7$(),t.Y8G("ngIf",c.isSubmitting)("ngIfElse",I)}}let et=(()=>{class o{fb;roomService;hotelService;route;router;snackBar;roomForm;hotels$;isEditMode=!1;isLoading=!1;isSubmitting=!1;roomId=null;preselectedHotelId=null;amenityInput="";constructor(e,r,n,p,b,h){this.fb=e,this.roomService=r,this.hotelService=n,this.route=p,this.router=b,this.snackBar=h}ngOnInit(){this.hotels$=this.hotelService.getHotels(),this.route.queryParams.subscribe(e=>{this.preselectedHotelId=e.hotelId||null}),this.initForm(),this.route.paramMap.pipe((0,u.n)(e=>{const r=e.get("id");return this.roomId=r,this.isEditMode=!!r,r?(this.isLoading=!0,this.roomService.getRoom(r)):(0,f.of)(null)})).subscribe({next:e=>{e?this.populateForm(e):this.preselectedHotelId&&this.roomForm.patchValue({hotelId:this.preselectedHotelId}),this.isLoading=!1},error:e=>{this.isLoading=!1,this.snackBar.open("Hiba a szoba bet\xf6lt\xe9sekor","Bez\xe1r\xe1s",{duration:3e3}),console.error(e)}})}initForm(){this.roomForm=this.fb.group({hotelId:[this.preselectedHotelId||"",a.k0.required],number:["",a.k0.required],type:["single",a.k0.required],price:[0,[a.k0.required,a.k0.min(0)]],capacity:[1,[a.k0.required,a.k0.min(1)]],description:["",a.k0.required],amenities:this.fb.array([]),images:this.fb.array([this.fb.control("")]),isAvailable:[!0]})}populateForm(e){this.roomForm.patchValue({hotelId:e.hotelId,number:e.number,type:e.type,price:e.price,capacity:e.capacity,description:e.description,isAvailable:e.isAvailable});const r=this.roomForm.get("amenities");r.clear(),e.amenities&&e.amenities.length>0&&e.amenities.forEach(p=>{r.push(this.fb.control(p))});const n=this.roomForm.get("images");n.clear(),e.images&&e.images.length>0?e.images.forEach(p=>{n.push(this.fb.control(p))}):n.push(this.fb.control(""))}get amenities(){return this.roomForm.get("amenities")}get images(){return this.roomForm.get("images")}addAmenity(){this.amenityInput.trim()&&(this.amenities.push(this.fb.control(this.amenityInput.trim())),this.amenityInput="")}removeAmenity(e){this.amenities.removeAt(e)}addImage(){this.images.push(this.fb.control(""))}removeImage(e){const r=this.roomForm.get("images");1===r.length?r.at(0).setValue(""):r.length>1&&r.removeAt(e)}onFileSelected(e){const r=e.target;if(!r.files||0===r.files.length)return;const p=Array.from(r.files).map(b=>new Promise((h,R)=>{const E=new FileReader;E.onload=()=>h(E.result),E.onerror=I=>R(I),E.readAsDataURL(b)}));Promise.all(p).then(b=>{const h=this.roomForm.get("images");b.forEach(R=>{let E=!1;for(let I=0;I<h.length;I++)if(!h.at(I).value){h.at(I).setValue(R),E=!0;break}E||h.push(this.fb.control(R))})})}onSubmit(){if(this.roomForm.invalid)return;this.isSubmitting=!0;const e=this.roomForm.value;e.images=e.images.filter(r=>""!==r.trim()),this.isEditMode&&this.roomId?this.roomService.updateRoom(this.roomId,e).subscribe({next:()=>{this.isSubmitting=!1,this.snackBar.open("Szoba sikeresen friss\xedtve","Bez\xe1r\xe1s",{duration:3e3}),this.router.navigate(this.preselectedHotelId?["/hotels",this.preselectedHotelId]:["/rooms"])},error:r=>{this.isSubmitting=!1,this.snackBar.open("Hiba a szoba friss\xedt\xe9sekor","Bez\xe1r\xe1s",{duration:3e3}),console.error(r)}}):this.roomService.addRoom(e).subscribe({next:()=>{this.isSubmitting=!1,this.snackBar.open("Szoba sikeresen l\xe9trehozva","Bez\xe1r\xe1s",{duration:3e3}),this.router.navigate(this.preselectedHotelId?["/hotels",this.preselectedHotelId]:["/rooms"])},error:r=>{this.isSubmitting=!1,this.snackBar.open("Hiba a szoba l\xe9trehoz\xe1sakor","Bez\xe1r\xe1s",{duration:3e3}),console.error(r)}})}static \u0275fac=function(r){return new(r||o)(t.rXU(a.ok),t.rXU(D.N),t.rXU(j.g),t.rXU(F.nX),t.rXU(F.Ix),t.rXU(_.UG))};static \u0275cmp=t.VBU({type:o,selectors:[["app-room-form"]],decls:9,vars:3,consts:[["formContent",""],["buttonText",""],[1,"room-form-container"],[4,"ngIf","ngIfElse"],[1,"loading-spinner"],[3,"ngSubmit","formGroup"],[1,"form-row"],["appearance","outline",1,"full-width"],["formControlName","hotelId"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["matInput","","formControlName","number","placeholder","Szobasz\xe1m"],["formControlName","type"],["value","Egy\xe1gyas"],["value","K\xe9t\xe1gyas"],["value","Lakoszt\xe1ly"],["value","Deluxe"],[1,"form-row","price-capacity-row"],["appearance","outline"],["matInput","","type","number","formControlName","price","min","0"],["matInput","","type","number","formControlName","capacity","min","1"],["matInput","","formControlName","description","rows","4","placeholder","Le\xedr\xe1s"],[1,"amenities-input"],["appearance","outline",1,"amenity-field"],["matInput","","placeholder","Pl. WiFi, TV, stb.",3,"ngModelChange","ngModel","ngModelOptions"],["type","button","mat-mini-fab","","color","primary",3,"click"],["class","amenities-list",4,"ngIf"],["formArrayName","images",1,"images-container"],["class","image-input",4,"ngFor","ngForOf"],["type","file","multiple","","accept","image/*",3,"change"],["type","button","mat-stroked-button","","color","primary",3,"click"],[1,"form-actions"],["mat-button","","type","button",3,"routerLink"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"],[1,"amenities-list"],[3,"removed",4,"ngFor","ngForOf"],[3,"removed"],["matChipRemove",""],[1,"image-input"],["appearance","outline",1,"image-field"],["matInput","","placeholder","https://example.com/image.jpg",3,"formControlName"],["type","button","mat-icon-button","","color","warn",3,"click","disabled"],["alt","Preview","class","image-preview",3,"src",4,"ngIf"],["alt","Preview",1,"image-preview",3,"src"],["diameter","24"]],template:function(r,n){if(1&r&&(t.j41(0,"div",2)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),t.EFF(4),t.k0s()(),t.j41(5,"mat-card-content"),t.DNE(6,G,3,0,"ng-container",3)(7,tt,77,24,"ng-template",null,0,t.C5r),t.k0s()()()),2&r){const p=t.sdS(8);t.R7$(4),t.JRh(n.isEditMode?"Szoba szerkeszt\xe9se":"\xdaj szoba hozz\xe1ad\xe1sa"),t.R7$(2),t.Y8G("ngIf",n.isLoading)("ngIfElse",p)}},dependencies:[m.MD,m.Sq,m.bT,m.Jj,a.X1,a.qT,a.me,a.Q0,a.BC,a.cb,a.VZ,a.j4,a.JD,a.v8,a.YN,a.vS,F.Wk,C.Hu,C.RN,C.m2,C.MM,C.dh,k.M,x.k,x.b,x.d,P.fS,P.fg,v.a,v.M,T.a,y.h,y.M,B.a,y.e,g.M,g.d,s.YN,s.Jl,s.Zv,s.Jo,l.D6,l.LG,_._T],styles:[".room-form-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}@media (max-width: 599px){.room-form-container[_ngcontent-%COMP%]{padding:10px}}.form-row[_ngcontent-%COMP%]{margin-bottom:16px}.image-preview[_ngcontent-%COMP%]{width:100px;height:auto;margin-top:10px;border:1px solid #ccc;padding:5px;border-radius:5px}.price-capacity-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}@media (max-width: 599px){.price-capacity-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:0}}.full-width[_ngcontent-%COMP%]{width:100%}.amenities-input[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;margin-bottom:10px}.amenities-input[_ngcontent-%COMP%]   .amenity-field[_ngcontent-%COMP%]{flex:1}.amenities-list[_ngcontent-%COMP%]{margin-bottom:16px}.images-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px}.images-container[_ngcontent-%COMP%]   .image-input[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px}.images-container[_ngcontent-%COMP%]   .image-input[_ngcontent-%COMP%]   .image-field[_ngcontent-%COMP%]{flex:1}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;margin-top:24px}@media (max-width: 599px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}h3[_ngcontent-%COMP%]{margin-bottom:10px;color:#3f51b5;font-weight:500}@media (max-width: 599px){h3[_ngcontent-%COMP%]{font-size:1.1rem}}"]})}return o})()},8081:(O,M,i)=>{i.d(M,{N:()=>P});var m=i(5891),a=i(8455),F=i(6354),C=i(7673),k=i(9498);let P=(()=>{class v{database=(0,m.C3)();roomsPath="rooms";constructor(){}getRooms(){const g=(0,m.KR)(this.database,this.roomsPath);return(0,a.H)((0,m.Jt)(g)).pipe((0,F.T)(s=>{const l=[];return s.exists()&&s.forEach(_=>{const u=_.val();return u.id=_.key,l.push(u),!1}),l.sort((_,u)=>_.number.localeCompare(u.number))}))}getRoomsByHotel(g){const s=(0,m.P)((0,m.KR)(this.database,this.roomsPath),(0,m.kT)("hotelId"),(0,m.iz)(g));return(0,a.H)((0,m.Jt)(s)).pipe((0,F.T)(l=>{const _=[];return l.exists()&&l.forEach(u=>{const f=u.val();return f.id=u.key,_.push(f),!1}),_.sort((u,f)=>u.number.localeCompare(f.number))}))}getAvailableRooms(){const g=(0,m.KR)(this.database,this.roomsPath);return(0,a.H)((0,m.Jt)(g)).pipe((0,F.T)(s=>{const l=[];return s.exists()&&s.forEach(_=>{const u=_.val();return u.isAvailable&&(u.id=_.key,l.push(u)),!1}),l.sort((_,u)=>_.price-u.price)}))}getAvailableRoomsByHotel(g){const s=(0,m.KR)(this.database,this.roomsPath);return(0,a.H)((0,m.Jt)(s)).pipe((0,F.T)(l=>{const _=[];return l.exists()&&l.forEach(u=>{const f=u.val();return f.isAvailable&&f.hotelId===g&&(f.id=u.key,_.push(f)),!1}),_.sort((u,f)=>u.price-f.price)}))}getRoomsByType(g){const s=(0,m.KR)(this.database,this.roomsPath);return(0,a.H)((0,m.Jt)(s)).pipe((0,F.T)(l=>{const _=[];return l.exists()&&l.forEach(u=>{const f=u.val();return f.type===g&&(f.id=u.key,_.push(f)),!1}),_.sort((u,f)=>u.price-f.price)}))}getRoom(g){const s=(0,m.KR)(this.database,`${this.roomsPath}/${g}`);return(0,a.H)((0,m.Jt)(s)).pipe((0,F.T)(l=>{if(l.exists()){const _=l.val();return _.id=l.key,_}throw new Error("Szoba nem tal\xe1lhat\xf3!")}))}addRoom(g){const s=(0,m.KR)(this.database,this.roomsPath),l=(0,m.VC)(s);return(0,a.H)((0,m.hZ)(l,g)).pipe((0,F.T)(()=>l.key||""))}updateRoom(g,s){const l=(0,m.KR)(this.database,`${this.roomsPath}/${g}`);return(0,a.H)((0,m.yo)(l,s))}deleteRoom(g){const s=(0,m.KR)(this.database,`${this.roomsPath}/${g}`);return(0,a.H)((0,m.TF)(s))}checkRoomAvailability(g,s,l){return(0,C.of)(!0)}static \u0275fac=function(s){return new(s||v)};static \u0275prov=k.jDH({token:v,factory:v.\u0275fac,providedIn:"root"})}return v})()}}]);