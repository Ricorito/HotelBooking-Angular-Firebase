"use strict";(self.webpackChunkszallas_foglalo=self.webpackChunkszallas_foglalo||[]).push([[972],{6972:(nt,f,a)=>{a.r(f),a.d(f,{BookingFormComponent:()=>et});var c=a(177),m=a(9417),k=a(8498),d=a(5596),R=a(8599),h=a(3746),F=a(4308),E=a(5084),j=a(3),b=a(2798),D=a(9183),v=a(8822),x=a(4572),C=a(5558),z=a(7673),P=a(6354),t=a(9498),S=a(369),U=a(8081),G=a(4796),p=a(3733),N=a(1958);function L(n,s){1&n&&(t.qex(0),t.j41(1,"div",7),t.nrm(2,"mat-spinner"),t.k0s(),t.bVm())}function $(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," A n\xe9v megad\xe1sa k\xf6telez\u0151! "),t.k0s())}function A(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," Az email megad\xe1sa k\xf6telez\u0151! "),t.k0s())}function W(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," K\xe9rlek megfelel\u0151 email c\xedmet adj meg! "),t.k0s())}function K(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," Telefonsz\xe1m megad\xe1sa k\xf6telez\u0151! "),t.k0s())}function y(n,s){if(1&n&&(t.qex(0),t.j41(1,"mat-option",28),t.EFF(2),t.nI1(3,"currency"),t.k0s(),t.bVm()),2&n){const e=s.$implicit;t.R7$(),t.Y8G("value",e.id),t.R7$(),t.E5c(" ",e.number," - ",e.type," (",t.ii3(3,4,e.price,"HUF","symbol","1.0-0"),"/\xe9jszaka) ")}}function Y(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," Szobav\xe1laszt\xe1s k\xf6telez\u0151! "),t.k0s())}function V(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," \xc9rkez\xe9s napj\xe1t k\xf6telez\u0151 megadni. "),t.k0s())}function X(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," T\xe1voz\xe1s napj\xe1t k\xf6telez\u0151 megadni. "),t.k0s())}function H(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," A t\xe1voz\xe1s d\xe1tuma k\xe9s\u0151bb kell legyen, mint az \xe9rkez\xe9s\xe9! "),t.k0s())}function J(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," \xc1r kisz\xe1m\xedt\xe1sa sz\xfcks\xe9ges "),t.k0s())}function Z(n,s){1&n&&(t.j41(0,"mat-error"),t.EFF(1," Az \xe1rnak nagyobbnak kell lennie 0-n\xe1l "),t.k0s())}function w(n,s){1&n&&(t.qex(0),t.j41(1,"div",9)(2,"mat-form-field",11)(3,"mat-label"),t.EFF(4,"\xc1llapot"),t.k0s(),t.j41(5,"mat-select",29)(6,"mat-option",30),t.EFF(7,"Meger\u0151s\xedtve"),t.k0s(),t.j41(8,"mat-option",31),t.EFF(9,"F\xfcgg\u0151ben"),t.k0s(),t.j41(10,"mat-option",32),t.EFF(11,"T\xf6r\xf6lve"),t.k0s()()()(),t.bVm())}function Q(n,s){1&n&&(t.qex(0),t.nrm(1,"mat-spinner",33),t.bVm())}function q(n,s){if(1&n&&t.EFF(0),2&n){const e=t.XpG(2);t.SpI(" ",e.isEditMode?"Friss\xedt\xe9s":"Foglal\xe1s"," ")}}function tt(n,s){if(1&n){const e=t.RV6();t.j41(0,"form",8),t.bIt("ngSubmit",function(){t.eBV(e);const r=t.XpG();return t.Njj(r.onSubmit())}),t.j41(1,"div",9)(2,"mat-card-title",10),t.EFF(3,"Teljes n\xe9v:"),t.k0s(),t.j41(4,"mat-form-field",11)(5,"mat-label"),t.EFF(6,"Vend\xe9g neve"),t.k0s(),t.nrm(7,"input",12),t.DNE(8,$,2,0,"mat-error",13),t.k0s()(),t.j41(9,"div",9)(10,"mat-card-title",14),t.EFF(11,"Email:"),t.k0s(),t.j41(12,"mat-form-field",11)(13,"mat-label"),t.EFF(14,"Email c\xedm"),t.k0s(),t.nrm(15,"input",15),t.DNE(16,A,2,0,"mat-error",13)(17,W,2,0,"mat-error",13),t.k0s()(),t.j41(18,"div",9)(19,"mat-card-title",10),t.EFF(20,"Telefonsz\xe1m:"),t.k0s(),t.j41(21,"mat-form-field",11)(22,"mat-label"),t.EFF(23,"Telefonsz\xe1m"),t.k0s(),t.nrm(24,"input",16),t.DNE(25,K,2,0,"mat-error",13),t.k0s()(),t.j41(26,"div",9)(27,"mat-card-title",10),t.EFF(28,"V\xe1lassz szob\xe1t:"),t.k0s(),t.j41(29,"mat-form-field",11)(30,"mat-label"),t.EFF(31,"Szoba"),t.k0s(),t.j41(32,"mat-select",17),t.bIt("selectionChange",function(r){t.eBV(e);const l=t.XpG();return t.Njj(l.onRoomSelected(r.value))}),t.DNE(33,y,4,9,"ng-container",18),t.nI1(34,"async"),t.k0s(),t.DNE(35,Y,2,0,"mat-error",13),t.k0s()(),t.j41(36,"div",19)(37,"mat-form-field",20)(38,"mat-label"),t.EFF(39,"\xc9rkez\xe9s napja"),t.k0s(),t.j41(40,"input",21),t.bIt("dateChange",function(){let r;t.eBV(e);const l=t.XpG();return t.Njj(l.calculateTotalPrice(null==(r=l.bookingForm.get("checkInDate"))?null:r.value,null==(r=l.bookingForm.get("checkOutDate"))?null:r.value))}),t.k0s(),t.nrm(41,"mat-datepicker-toggle",22)(42,"mat-datepicker",null,1),t.DNE(44,V,2,0,"mat-error",13),t.k0s(),t.j41(45,"mat-form-field",20)(46,"mat-label"),t.EFF(47,"T\xe1voz\xe1s napja"),t.k0s(),t.j41(48,"input",23),t.bIt("dateChange",function(){let r;t.eBV(e);const l=t.XpG();return t.Njj(l.calculateTotalPrice(null==(r=l.bookingForm.get("checkInDate"))?null:r.value,null==(r=l.bookingForm.get("checkOutDate"))?null:r.value))}),t.k0s(),t.nrm(49,"mat-datepicker-toggle",22)(50,"mat-datepicker",null,2),t.DNE(52,X,2,0,"mat-error",13)(53,H,2,0,"mat-error",13),t.k0s()(),t.j41(54,"div",9)(55,"mat-form-field",11)(56,"mat-label"),t.EFF(57,"Teljes \xe1r"),t.k0s(),t.nrm(58,"input",24),t.nI1(59,"currency"),t.DNE(60,J,2,0,"mat-error",13)(61,Z,2,0,"mat-error",13),t.k0s()(),t.DNE(62,w,12,0,"ng-container",13),t.j41(63,"div",25)(64,"button",26),t.EFF(65,"Vissza"),t.k0s(),t.j41(66,"button",27),t.DNE(67,Q,2,0,"ng-container",6)(68,q,1,1,"ng-template",null,3,t.C5r),t.k0s()()()}if(2&n){let e,o,r,l,u,g,_,I,M,B;const O=t.sdS(43),T=t.sdS(51),ot=t.sdS(69),i=t.XpG();t.Y8G("formGroup",i.bookingForm),t.R7$(8),t.Y8G("ngIf",(null==(e=i.bookingForm.get("guestName"))?null:e.hasError("required"))&&(null==(e=i.bookingForm.get("guestName"))?null:e.touched)),t.R7$(8),t.Y8G("ngIf",(null==(o=i.bookingForm.get("guestEmail"))?null:o.hasError("required"))&&(null==(o=i.bookingForm.get("guestEmail"))?null:o.touched)),t.R7$(),t.Y8G("ngIf",(null==(r=i.bookingForm.get("guestEmail"))?null:r.hasError("email"))&&(null==(r=i.bookingForm.get("guestEmail"))?null:r.touched)),t.R7$(8),t.Y8G("ngIf",(null==(l=i.bookingForm.get("guestPhone"))?null:l.hasError("required"))&&(null==(l=i.bookingForm.get("guestPhone"))?null:l.touched)),t.R7$(8),t.Y8G("ngForOf",t.bMT(34,21,i.availableRooms$)),t.R7$(2),t.Y8G("ngIf",(null==(u=i.bookingForm.get("roomId"))?null:u.hasError("required"))&&(null==(u=i.bookingForm.get("roomId"))?null:u.touched)),t.R7$(5),t.Y8G("matDatepicker",O),t.R7$(),t.Y8G("for",O),t.R7$(3),t.Y8G("ngIf",(null==(g=i.bookingForm.get("checkInDate"))?null:g.hasError("required"))&&(null==(g=i.bookingForm.get("checkInDate"))?null:g.touched)),t.R7$(4),t.Y8G("matDatepicker",T),t.R7$(),t.Y8G("for",T),t.R7$(3),t.Y8G("ngIf",(null==(_=i.bookingForm.get("checkOutDate"))?null:_.hasError("required"))&&(null==(_=i.bookingForm.get("checkOutDate"))?null:_.touched)),t.R7$(),t.Y8G("ngIf",i.bookingForm.hasError("dateRangeInvalid")),t.R7$(5),t.Y8G("value",t.ii3(59,23,null==(I=i.bookingForm.get("totalPrice"))?null:I.value,"HUF","symbol","1.0-0")),t.R7$(2),t.Y8G("ngIf",null==(M=i.bookingForm.get("totalPrice"))?null:M.hasError("required")),t.R7$(),t.Y8G("ngIf",null==(B=i.bookingForm.get("totalPrice"))?null:B.hasError("min")),t.R7$(),t.Y8G("ngIf",i.isEditMode),t.R7$(4),t.Y8G("disabled",i.bookingForm.invalid||i.isSubmitting),t.R7$(),t.Y8G("ngIf",i.isSubmitting)("ngIfElse",ot)}}let et=(()=>{class n{fb;bookingService;roomService;authService;route;router;snackBar;bookingForm;availableRooms$;isEditMode=!1;isLoading=!1;isSubmitting=!1;bookingId=null;selectedRoomPrice=0;constructor(e,o,r,l,u,g,_){this.fb=e,this.bookingService=o,this.roomService=r,this.authService=l,this.route=u,this.router=g,this.snackBar=_}ngOnInit(){this.initForm(),this.availableRooms$=this.roomService.getRooms(),(0,x.z)([this.bookingForm.get("checkInDate").valueChanges,this.bookingForm.get("checkOutDate").valueChanges]).subscribe(([e,o])=>{e&&o&&this.selectedRoomPrice>0&&this.calculateTotalPrice(e,o)}),this.route.paramMap.pipe((0,C.n)(e=>{const o=e.get("id");return this.bookingId=o,this.isEditMode=!!o,o?(this.isLoading=!0,this.bookingService.getBooking(o)):(0,z.of)(null)})).subscribe({next:e=>{e&&(this.populateForm(e),this.availableRooms$.pipe((0,P.T)(o=>o.find(r=>r.id===e.roomId))).subscribe(o=>{o&&(this.selectedRoomPrice=o.price)})),this.isLoading=!1},error:e=>{this.isLoading=!1,this.snackBar.open("Hiba a foglal\xe1s bet\xf6lt\xe9se sor\xe1n","Bez\xe1r",{duration:3e3}),console.error(e)}})}initForm(){this.bookingForm=this.fb.group({guestName:["",m.k0.required],guestEmail:["",[m.k0.required,m.k0.email]],guestPhone:["",m.k0.required],roomId:["",m.k0.required],checkInDate:[new Date,m.k0.required],checkOutDate:[new Date(Date.now()+864e5),m.k0.required],totalPrice:[0,[m.k0.required,m.k0.min(1)]],status:["pending"]})}onRoomSelected(e){this.availableRooms$.pipe((0,P.T)(o=>o.find(r=>r.id===e))).subscribe(o=>{o&&(this.selectedRoomPrice=o.price,this.calculateTotalPrice(this.bookingForm.get("checkInDate")?.value,this.bookingForm.get("checkOutDate")?.value))})}calculateTotalPrice(e,o){if(!e||!o||this.selectedRoomPrice<=0)return;const r=o.getTime()-e.getTime(),l=Math.ceil(r/864e5);if(l>0){const u=l*this.selectedRoomPrice;this.bookingForm.get("totalPrice")?.setValue(u)}else this.bookingForm.get("totalPrice")?.setValue(0)}populateForm(e){this.bookingForm.patchValue({guestName:e.guestName,guestEmail:e.guestEmail,guestPhone:e.guestPhone,roomId:e.roomId,checkInDate:e.checkInDate,checkOutDate:e.checkOutDate,totalPrice:e.totalPrice,status:e.status})}onSubmit(){if(this.bookingForm.invalid)return;this.isSubmitting=!0;const e=this.bookingForm.value;this.isEditMode&&this.bookingId?this.updateBooking(e):this.createBooking(e)}updateBooking(e){this.bookingService.updateBooking(this.bookingId,e).subscribe({next:()=>{this.isSubmitting=!1,this.snackBar.open("Foglal\xe1s sikeresen friss\xedtve!","Bez\xe1r",{duration:3e3}),this.router.navigate(["/bookings"])},error:o=>{this.handleError(o,"Hiba a foglal\xe1s friss\xedt\xe9se sor\xe1n")}})}createBooking(e){this.authService.currentUser$.pipe((0,C.n)(o=>{if(!o)throw new Error("Felhaszn\xe1l\xf3 nincs hiteles\xedtve");const r={...e,userId:o.uid,status:"pending"};return this.bookingService.addBooking(r)})).subscribe({next:()=>{this.isSubmitting=!1,this.snackBar.open("Sikeres foglal\xe1s!","Bez\xe1r",{duration:3e3}),this.router.navigate(["/bookings"])},error:o=>{this.handleError(o,"Hiba a foglal\xe1s sor\xe1n!")}})}handleError(e,o){this.isSubmitting=!1,this.snackBar.open(o,"Bez\xe1r",{duration:3e3}),console.error(e)}static \u0275fac=function(o){return new(o||n)(t.rXU(m.ok),t.rXU(S.L),t.rXU(U.N),t.rXU(G.u),t.rXU(k.nX),t.rXU(k.Ix),t.rXU(v.UG))};static \u0275cmp=t.VBU({type:n,selectors:[["app-booking-form"]],decls:9,vars:3,consts:[["formContent",""],["checkInPicker",""],["checkOutPicker",""],["buttonText",""],[1,"booking-form-container"],[2,"font-size","24px","padding-bottom","15px"],[4,"ngIf","ngIfElse"],[1,"loading-spinner"],[3,"ngSubmit","formGroup"],[1,"form-row"],[2,"font-size","16px"],["appearance","outline",1,"full-width"],["matInput","","formControlName","guestName","placeholder","Vend\xe9g neve"],[4,"ngIf"],[2,"font-size","16px","padding","0","margin","0"],["matInput","","formControlName","guestEmail","type","email","placeholder","Vend\xe9g Email"],["matInput","","formControlName","guestPhone","placeholder","Vend\xe9g Telefonsz\xe1m"],["formControlName","roomId",3,"selectionChange"],[4,"ngFor","ngForOf"],[1,"form-row","date-row"],["appearance","outline"],["matInput","","formControlName","checkInDate",3,"dateChange","matDatepicker"],["matSuffix","",3,"for"],["matInput","","formControlName","checkOutDate",3,"dateChange","matDatepicker"],["matInput","","formControlName","totalPrice","type","text","placeholder","Teljes \xe1r","readonly","",3,"value"],[1,"form-actions"],["mat-button","","type","button","routerLink","/bookings"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"],["formControlName","status"],["value","confirmed"],["value","pending"],["value","cancelled"],["diameter","24"]],template:function(o,r){if(1&o&&(t.j41(0,"div",4)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title",5),t.EFF(4),t.k0s()(),t.j41(5,"mat-card-content"),t.DNE(6,L,3,0,"ng-container",6)(7,tt,70,28,"ng-template",null,0,t.C5r),t.k0s()()()),2&o){const l=t.sdS(8);t.R7$(4),t.JRh(r.isEditMode?"Foglal\xe1s szerkeszt\xe9se":"\xdaj foglal\xe1s"),t.R7$(2),t.Y8G("ngIf",r.isLoading)("ngIfElse",l)}},dependencies:[c.MD,c.Sq,c.bT,c.Jj,c.oe,m.X1,m.qT,m.me,m.BC,m.cb,m.j4,m.JD,k.Wk,d.Hu,d.RN,d.m2,d.MM,d.dh,R.M,p.k,p.b,p.d,p.i,h.fS,h.fg,F.a,F.M,N.a,E.X6,E.Vh,E.bZ,E.bU,j.WX,b.h,b.M,D.D6,D.LG,v._T],styles:[".booking-form-container[_ngcontent-%COMP%]{padding:20px;max-width:800px;margin:0 auto}@media (max-width: 599px){.booking-form-container[_ngcontent-%COMP%]{padding:10px}}.form-row[_ngcontent-%COMP%]{margin-bottom:16px}.date-row[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:16px}@media (max-width: 599px){.date-row[_ngcontent-%COMP%]{grid-template-columns:1fr;gap:0}}.full-width[_ngcontent-%COMP%]{width:100%}.form-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:16px;margin-top:24px}@media (max-width: 599px){.form-actions[_ngcontent-%COMP%]{flex-direction:column}.form-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%}}.loading-spinner[_ngcontent-%COMP%]{display:flex;justify-content:center;padding:40px}"]})}return n})()}}]);